<?php
/*
	Helps user recover forgotten user names and passwords by verifying and sending emails
	Uses m_Emails class to build and send emails
	Debug:
		Email and Password validation are the same as m_UserAccount class: make own class
*/

class m_Recovery {
	/*
		Properties
	*/
	
	
	/*
		Methods
		Email that gets sent gives user their username and password recovery links
	*/
	public static function start($email){
		$timehold = time();
		$hashed = password_hash($timehold, PASSWORD_BCRYPT);
		$hold = m_FindOne::result(m_var::get_database(),m_var::get_userAccount(),array('email'=>$email));
		
		if($hold != NULL){
			//		
			m_Email::recovery($email,$hold['_id'],$hashed);
			m_Update::result(m_var::get_database(),m_var::get_userAccount(),array('email' => $email),array('$set' => array('recovery' => $hashed,'time_left' => $timehold+86400))); //24hrs == 86400sec
		}
	}
	
	public static function finish(){
	
	}
	
	public static function cancel($time){
		m_Update::result(m_var::get_database(),m_var::get_userAccount(),array('recovery' => $time),array('$set' => array('recovery' => 'cancelled','time_left' => 0)));
	}
	
}

?>